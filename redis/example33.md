# 跳跃列表

  Redis中的zset是一个复合结构，它需要通过hash结构存储key和score，同时还需要通过score排序并且筛选出score范围内的key，这就需要一个新的结构-跳跃列表(skiplist)

### 跳跃列表(skiplist)

  Redis中跳跃列表共有64层，所以容纳2^64个元素应该不成问题。

  - 由kv header和kv组成
  - kv header是每一层的出发点
  - kv可能在多个层次中担任角色
  - kv晋升到更高层次的概率是随机的，并且层次越高晋升的概率越小。
  - kv之间通过指针连接起来想成双向链表

### 查找过程

  跳跃列表在查找的过程中，一层一层的遍历，找出一条搜索路径再进行操作。由于每次都要自上而下搜索，为了增加效率，跳跃列表会记录当前最大的层数maxLevel，这样遍历的性能会提高不少。（在添加，删除操作中我们就有必要更新跳跃列表的maxLevel）

### 插入过程

  执行插入操作，首先会找出一条搜索路径，然后创建新的节点，并且为这个新节点随机分配一个层数，将它与搜索路径上的节点通过向前前后的指针串起来，如果最大高度高于之前的高度，那么跳跃列表这时就需要修改maxLevel。

### 删除过程

  删除和插入有点类似，先找出一条搜索路径，删除该节点之后，将相关路径上的元素的前后指针重排一下，如果最大高度产生变化，跳跃列表则更新maxLevel

### 更新过程

  第一种情况：更新的score并不影响当前跳跃列表中节点排列的顺序，那么直接替换值就可以。

  第二种情况：更新的值会影响到跳跃列表中节点排列的顺序，Redis是这样处理的，先执行删除操作，再执行插入操作。

### 排序

  前面说到跳跃列表中的节点是有序的，那么这个顺序是怎么定的呢？仅仅是依靠score吗？那么如果score都一样，岂不是查找的时间复杂度变成了O(n)，当然作者不会不考虑这种情况，所以排序的条件是由key和value组合而成。

### 计算排名

  这个地方不知道没有明白什么意思。