### Sentinel

  前面说了Redis的主从同步，那么问题来了，如果主节点挂了怎么办？傻傻的等待运维换一个节点，然后程序才改为新的节点？

  接下来就是Sentinel表现的机会了。

### 简介

  Sentinel是集群的心脏，当主节点挂掉之后，会寻找一个可用的从节点作为主节点。从而保证系统高可用性。

  但是Sentinel无法保证数据不丢失，因为当主节点挂掉之后，可能从节点还没来得及同步数据，如果主节点延迟很高，那么丢失的数据就越多，所以这里我们可以限制主节点的延迟过高：

```s
  # 这个参数表示主节点必须至少有一个从节点进行正常的复制，否则停止服务。
  min-slaves-to-wrrite 1
  # 如果10s 没有收到从节点的反馈，则为异常复制
  min-slaves-max-log 10
```

### 主从设置

  需要配置Redis配置文件

```s
  slaveof 127.0.0.1 3010 # 在从节点中设置一个主节点
```

  实际上这里已经开始读写分离，从节点负责读，主节点负责写。

  查看从属关系
```s
  redis-cli -p 3010 INFO replication
```

### 配置sentinel

  实际上就是每一个节点都通过一个sentinel来监察。查看当前监察的节点：

```s
  redis-cli -p 26379 INFO sentinel
```