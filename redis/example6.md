# 布隆过滤器

  这里从一个新闻客户端推荐系统去重的问题出发。

  如果我们将历史记录存储在关系型数据库，那么就需要频繁的对数据库进行exists查询，当系统并发量很高的情况下，数据库很难抗住压力。

### 什么是布隆过滤器？

  布隆过滤器可以理解为一个简单的set结构，可以通过它使用contains方法判断某个对象是否存在，但是可能会误判。

  也就是说：当它判断一个对象存在时，可能它并不存在。

  这里就需要我们合理的设置判断条件，使布隆过滤器更加的准确。

### 使用

  布隆过滤器（rebloom）作为Redis4.0的插件使用。(安装详情在rebloom主页)

### 误判

  布隆过滤器对于已经见过的元素不会误判，它只会误判那些没有见过的元素。检查不存在的元素时，则会出现误判，误判率大概在1%左右。

  采用bf.reverse可以减少预期内的误判

```s
  # 0.0001 表示期望的误判率 要求越高 需要的内存越大
  # 100000 表示预期的数据量的大小，数据超出时，则误差会更大。
  bf.reverse data 0.0001 100000
```

### 原理

  每个布隆过滤器对应到Redis的数据结构里面就是一个大型的位数组和几个不一样的无偏hash函数（所谓无偏就是能够把元素的hash值算的比较的均匀）

  向布隆过滤器添加key时，会使用多个hash函数对key进行hash算的一个整数的索引值对位数组的长度进行取模，将对应位数组的位置值为1，则完成了add的操作。那么exists的操作和add的操作也是类似的。

