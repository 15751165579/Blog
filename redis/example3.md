# 延迟队列

### 异步消息队列

  在redis中，我们可以通过rpush/lpush操作入队列，使用lpop/rpop出队列。

  这里容易遇到的问题就是当队列中为空时，可能导致频繁无效的pop。

  这里可以采用blpop和brpop堵塞读在没有数据时，会进入休眠状态，但是此时的链接会变成闲置链接，时间一长，服务器会主动断开，那么就会抛出异常，这里需要主要对异常的捕获和处理。


### Node基于redis的框架 kue

- 未支付订单延迟取消，释放库存

  Redis的实现可以通过将订单保存在zset中，过期时间存在score中。然后通过zrangebyscore取出队列中的1个元素，到期后通过zrem解决多线程多进程抢任务的情况。

