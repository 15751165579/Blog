# Node Cluster（集群）

### cluster.fork vs child_process.fork

  cluster相比较child_process,它可以让各个工作进程共享TCP服务，对于多进程中一些比较复杂的问题，都交给了系统帮助我们处理。

### cluster如何工作

  cluster的工作进程实质上还是有child_process.fork方法创建的，因此是可以通过IPC和父进程通信的，从而使各个进程交替的处理连接服务。

  cluster模块支持两种分发模式：

  - （除了Windows）是循环法，主进程监听端口，接到新的请求循环分发给工作进程。在分发过程通过一些技巧语法部分工作进程负载。
  - 主进程创建监听socket后发送给感兴趣的工作进程，由工作进程直接接受连接。

  理论上第二种方法最佳，但是实际情况中，操作系统的调度机制让人难以捉摸，会使分发特别的不稳定，部分工作进程负载过高，这也就是”惊群“现象。

### master vs worker

  在cluster模式下。分为主进程和工作进程，主进程主要负责守护这些工作进程。